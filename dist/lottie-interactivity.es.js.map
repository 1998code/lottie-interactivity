{"version":3,"file":"lottie-interactivity.es.js","sources":["../src/main.js"],"sourcesContent":["const DEFAULT_OPTIONS = {\n  player: 'lottie-player',\n};\nconst LOTTIE_PLAYER_NODE = 'LOTTIE-PLAYER';\nconst ERROR_PREFIX = '[lottieInteractivity]:';\n\n/**\n * LottieFiles interactivity for Lottie\n */\nexport class LottieInteractivity {\n  constructor({ actions, container, mode, player, ...options } = DEFAULT_OPTIONS) {\n    // Resolve lottie instance specified in player option\n    if (!(typeof player === 'object' && player.constructor.name === 'AnimationItem')) {\n      if (typeof player === 'string') {\n        const elem = document.querySelector(player);\n\n        if (elem && elem.nodeName === LOTTIE_PLAYER_NODE) {\n          player = elem.getLottie();\n        }\n      } else if (player instanceof HTMLElement && player.nodeName === LOTTIE_PLAYER_NODE) {\n        player = player.getLottie();\n      }\n\n      // Throw error no player instance has been successfully resolved\n      if (!player) {\n        throw new Error(`${ERROR_PREFIX} Specified player is invalid.`, player);\n      }\n    }\n\n    // Get the configured container element.\n    if (typeof container === 'string') {\n      container = document.querySelector(container);\n    }\n\n    // Use player wrapper as fallback if container couldn't be resolved.\n    if (!container) {\n      container = player.wrapper;\n    }\n\n    this.player = player;\n    this.container = container;\n    this.mode = mode;\n    this.actions = actions;\n    this.options = options;\n  }\n\n  start() {\n    if (this.mode === 'scroll') {\n      window.addEventListener('scroll', this.#scrollHandler);\n    }\n\n    if (this.mode === 'hover') {\n      this.container.addEventListener('onmouseenter', this.#hoverStartHandler);\n      this.container.addEventListener('onmouseleave', this.#hoverEndHandler);\n    }\n  }\n\n  stop() {\n    if (this.mode === 'scroll') {\n      window.removeEventListener('scroll', this.#scrollHandler);\n    }\n\n    if (this.mode === 'hover') {\n      this.container.removeEventListener('onmouseenter', this.#hoverStartHandler);\n      this.container.removeEventListener('onmouseleave', this.#hoverEndHandler);\n    }\n  }\n\n  #hoverStartHandler = () => {};\n\n  #hoverEndHandler = () => {};\n\n  #scrollHandler = () => {\n    // Get the bounding box for the lottie player or container\n    const { top, height } = this.container.getBoundingClientRect();\n\n    // Calculate current view percentage\n    const current = window.innerHeight - top;\n    const max = window.innerHeight + height;\n    const currentPercent = current / max;\n\n    // // Skip if out of viewport\n    if (currentPercent < 0 || currentPercent > 1) {\n      return;\n    }\n\n    // Find the first action that satisfies the current position conditions\n    const action = this.actions.find(({ start, end }) => currentPercent >= start && currentPercent <= end);\n\n    // Skip if no matching action was found!\n    if (!action) {\n      return;\n    }\n\n    // Get lottie instance\n    this.player.loop = true;\n\n    // Process action types:\n    if (action.type === 'seek') {\n      // Seek: Go to a frame based on player scroll position action\n      this.player.playSegments(action.frames, true);\n      this.player.goToAndStop(\n        Math.ceil(((currentPercent - action.start) / (action.end - action.start)) * this.player.totalFrames),\n        true,\n      );\n    } else if (action.type === 'loop') {\n      // Loop: Loop a given frames\n      if (this.player.isPaused === true) {\n        this.player.playSegments(action.frames, true);\n      }\n    } else if (action.type === 'play') {\n      // Play: Reset segments and continue playing full animation from current position\n      if (this.player.isPaused === true) {\n        this.player.resetSegments();\n      }\n      this.player.play();\n    } else if (action.type === 'stop') {\n      // Stop: Stop playback\n      this.player.goToAndStop(action.frames[0]);\n      this.player.stop();\n      // TODO: This is not the way to implement this. Refactor needed!\n    } else if (action.type === 'hover') {\n      this.container.addEventListener('mouseenter', () => {\n        if (this.player.isPaused === true) {\n          this.player.playSegments(action.frames, true);\n        }\n      });\n      this.container.addEventListener('mouseleave', () => {\n        if (this.player.isPaused === false) {\n          this.player.pause();\n        }\n      });\n    }\n  };\n}\n\nexport const create = options => {\n  const instance = new LottieInteractivity(options);\n  instance.start();\n\n  return instance;\n};\n\nexport default create;\n"],"names":["DEFAULT_OPTIONS","player","LottieInteractivity","actions","container","mode","options","_this","getBoundingClientRect","top","height","currentPercent","window","innerHeight","action","find","start","end","loop","type","playSegments","frames","goToAndStop","Math","ceil","totalFrames","isPaused","resetSegments","play","stop","addEventListener","pause","_typeof","constructor","name","elem","document","querySelector","nodeName","getLottie","HTMLElement","Error","wrapper","this","removeEventListener","create","instance"],"mappings":"2+BAAA,IAAMA,EAAkB,CACtBC,OAAQ,iBAQGC,8FACoDF,EAAjDG,IAAAA,QAASC,IAAAA,UAAWC,IAAAA,KAAMJ,IAAAA,OAAWK,0FA0D9B,6CAEF,6CAEF,iBAESC,EAAKH,UAAUI,wBAA/BC,IAAAA,IAAKC,IAAAA,OAKPC,GAFUC,OAAOC,YAAcJ,IACzBG,OAAOC,YAAcH,QAI7BC,EAAiB,GAAKA,EAAiB,QAKrCG,EAASP,EAAKJ,QAAQY,MAAK,gBAAGC,IAAAA,MAAOC,IAAAA,WAAUN,GAAkBK,GAASL,GAAkBM,KAG7FH,IAKLP,EAAKN,OAAOiB,MAAO,EAGC,SAAhBJ,EAAOK,MAETZ,EAAKN,OAAOmB,aAAaN,EAAOO,QAAQ,GACxCd,EAAKN,OAAOqB,YACVC,KAAKC,MAAOb,EAAiBG,EAAOE,QAAUF,EAAOG,IAAMH,EAAOE,OAAUT,EAAKN,OAAOwB,cACxF,IAEuB,SAAhBX,EAAOK,MAEa,IAAzBZ,EAAKN,OAAOyB,UACdnB,EAAKN,OAAOmB,aAAaN,EAAOO,QAAQ,GAEjB,SAAhBP,EAAOK,OAEa,IAAzBZ,EAAKN,OAAOyB,UACdnB,EAAKN,OAAO0B,gBAEdpB,EAAKN,OAAO2B,QACa,SAAhBd,EAAOK,MAEhBZ,EAAKN,OAAOqB,YAAYR,EAAOO,OAAO,IACtCd,EAAKN,OAAO4B,QAEa,UAAhBf,EAAOK,OAChBZ,EAAKH,UAAU0B,iBAAiB,cAAc,YACf,IAAzBvB,EAAKN,OAAOyB,UACdnB,EAAKN,OAAOmB,aAAaN,EAAOO,QAAQ,MAG5Cd,EAAKH,UAAU0B,iBAAiB,cAAc,YACf,IAAzBvB,EAAKN,OAAOyB,UACdnB,EAAKN,OAAO8B,iBArHM,WAAlBC,EAAO/B,IAAmD,kBAA5BA,EAAOgC,YAAYC,KAA2B,IAC1D,iBAAXjC,EAAqB,KACxBkC,EAAOC,SAASC,cAAcpC,GAEhCkC,GAbe,kBAaPA,EAAKG,WACfrC,EAASkC,EAAKI,kBAEPtC,aAAkBuC,aAhBR,kBAgBuBvC,EAAOqC,WACjDrC,EAASA,EAAOsC,iBAIbtC,QACG,IAAIwC,gBArBG,0DAqBmDxC,GAK3C,iBAAdG,IACTA,EAAYgC,SAASC,cAAcjC,IAIhCA,IACHA,EAAYH,EAAOyC,cAGhBzC,OAASA,OACTG,UAAYA,OACZC,KAAOA,OACPF,QAAUA,OACVG,QAAUA,yDAIG,WAAdqC,KAAKtC,MACPO,OAAOkB,iBAAiB,WAAUa,SAGlB,UAAdA,KAAKtC,YACFD,UAAU0B,iBAAiB,iBAAgBa,cAC3CvC,UAAU0B,iBAAiB,iBAAgBa,yCAKhC,WAAdA,KAAKtC,MACPO,OAAOgC,oBAAoB,WAAUD,SAGrB,UAAdA,KAAKtC,YACFD,UAAUwC,oBAAoB,iBAAgBD,cAC9CvC,UAAUwC,oBAAoB,iBAAgBD,yFAwE5CE,EAAS,SAAAvC,OACdwC,EAAW,IAAI5C,EAAoBI,UACzCwC,EAAS9B,QAEF8B"}